#! /bin/bash
#
# This wrapper script attempts to figure out if it was invoked from inside an
# nvim terminal. If not, it will start nvim normally. If so, it will attempt to
# run the requested commands against the existing nvim instance by sending them
# over the msgpack communication channel.
#

if [[ -z $NVIM_LISTEN_ADDRESS ]]; then
  exec nvim "$@"
else
  file=$1
  if [[ ${file:0:1} != '/' ]]; then
    file="$(pwd)/${file}"
  fi
  ${HOME}/home-dir/bin/nvim-command 'wincmd k'
  ${HOME}/home-dir/bin/nvim-command "e $file"
fi
